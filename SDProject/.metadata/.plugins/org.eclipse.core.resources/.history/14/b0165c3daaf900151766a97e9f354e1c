package ctrl;

import java.io.IOException;
import java.util.ArrayList;

import lipermi.exception.LipeRMIException;
import lipermi.handler.CallHandler;
import lipermi.net.Server;
import vw.ViewerFrame;

/**
 * This is the server of the application
 */
public class SupervisorServer {

	private Server server;
	private int port;
	private ViewerFrame viewer;
	private ArrayList<String> clients;
	
	public SupervisorServer(){
		
		clients = new ArrayList<String>();
		
		System.out.println("SERVER : Begin");
		
		
		System.out.println("SERVER :	Binding ...");
		this.server = new Server();
		
		System.out.println("SERVER :		Listing services ...");
		ConnectivityServicesImpl connectivityServices = new ConnectivityServicesImpl(this);
		CallHandler cH = new CallHandler();
		try{
			cH.registerGlobal(ConnectivityServices.class, connectivityServices);
		}catch(LipeRMIException e){
			e.printStackTrace();
		}
		System.out.println("SERVER :		Services ok");
		
		System.out.println("SERVER :		Searching port ...");
		this.port = 5000;
		Boolean portOk = false;
		
		while (!portOk){
			try{
				server.bind(this.port, cH);
				portOk = true;
			}catch(IOException e){
				this.port++;
			}
		}
		
		System.out.println("SERVER :		Port ok");
		System.out.println("SERVER :	Binding ok");
		
		
		
		System.out.println("SERVER : Listening on port : "+this.port);
	}
	
	/**
	 * Method use to know the port which the server running on
	 * @return The port of the server
	 */
	public int getPort(){
		return this.port;
	}
	
	/**
	 * Référence to the frame of the server
	 * @param wf
	 */
	public void setViewer(ViewerFrame wf){
		this.viewer = wf;
	}
	
	/**
	 * Method use to add a client into the server and to refresh the frame
	 * @param name
	 */
	public void addClient(SupervisedClient client){
		this.clients.add(name);
		this.viewer.addClient(name);
	}
}
